name: Update README and Generate Banner on Issue Creation

on:
  issues:
    types:
      - opened

jobs:
  update-readme-and-generate-banner:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Set up Python
        uses: actions/setup-python@v2
        with:
          python-version: 3.x

      - name: Install Pillow
        run: |
          python -m pip install --upgrade pip
          pip install Pillow

      - name: Extract X and Y coordinates
        id: extract-coordinates
        run: |
          # Extract X and Y coordinates from the issue title
          issue_title="${{ github.event.issue.title }}"
          IFS=',' read -r x_coord y_coord <<< "${issue_title}"

          echo "X Coordinate: ${x_coord}"
          echo "Y Coordinate: ${y_coord}"

          echo "::set-output name=x_coord::${x_coord}"
          echo "::set-output name=y_coord::${y_coord}"

      - name: Run generate_banner.py
        run: |
          x_coord="${{ steps.extract-coordinates.outputs.x_coord }}"
          y_coord="${{ steps.extract-coordinates.outputs.y_coord }}"

          python generate_banner.py "${x_coord}" "${y_coord}"

      - name: Update README
        run: |
          echo "- **Issue Title:** ${{ github.event.issue.title }}" >> README.md
          echo "  **Created by:** ${{ github.event.issue.user.login }}" >> README.md
          echo "  **X Coordinate:** ${{ steps.extract-coordinates.outputs.x_coord }}" >> README.md
          echo "  **Y Coordinate:** ${{ steps.extract-coordinates.outputs.y_coord }}" >> README.md

      - name: Commit changes
        run: |
          git config user.name "${{ github.actor }}"
          git config user.email "${{ github.actor }}@users.noreply.github.com"
          git add README.md
          git commit -m "Append README with issue information and generate banner"
          git push
